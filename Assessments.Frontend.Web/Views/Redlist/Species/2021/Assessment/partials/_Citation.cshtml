@using Microsoft.AspNetCore.Http.Extensions
@using Assessments.Frontend.Web.Infrastructure.Services

@model SpeciesAssessment2021

@inject ExpertCommitteeMemberService _expertCommitteeMemberService

@{
    var expertCommitteeMembers = await _expertCommitteeMemberService.GetExpertCommitteeMembers(Model.ExpertCommittee, Model.AssessmentYear);
    var sortedExperts = @expertCommitteeMembers.OrderBy(x => x.Role).ThenBy(x => x.LastName);
    var formattedExperts = sortedExperts.Select(x => $"{x.LastName} {x.FirstNameInitals}").Distinct().ToList();
    string authors = formattedExperts.JoinAnd(", ", " og ");
    string firspublished = Helpers.getPublishedDate(Model.AssessmentYear, Model.YearPreviousAssessment);
    string revisiondate = Helpers.getRevisionDate(Model.RevisionDate, firspublished);
    string date = "(2021, 24. november).";
    string species = Model.PopularName + " " + Model.ScientificName;
    string area = (Model.AssessmentArea == "N" ? "Norge" : "Svalbard");
    string articlename = Model.SpeciesGroup + ": Vurdering av " + species + " for " + area + ".";
    string publication = "Norsk rødliste for arter 2021. Artsdatabanken. ";

    if (!string.IsNullOrWhiteSpace(Model.RevisionReason)) {
        date = "(" + revisiondate + ")";
    }
}

@if (expertCommitteeMembers.Any())
{
    <h2>Sitering</h2>
    <p class="citation">
        @authors
        @date
        @articlename
        @publication
        @Context.Request.GetEncodedUrl()
    </p>
}


@if (!string.IsNullOrWhiteSpace(Model.RevisionReason))
{
    <p>
        MER SITER
    </p>
}