@model SpeciesAssessment2021
@using Assessments.Frontend.Web.Infrastructure.Services
@inject ExpertCommitteeMemberService _expertCommitteeMemberService
@{
    ViewBag.Title = Model.ScientificName + " - Rødlista 2021";

    Dictionary<string, Dictionary<string, string>> speciesGroups = ViewBag.speciesgroup.ToObject<Dictionary<string, Dictionary<string, string>>>();

    string speciesGroupImageUrl = String.Empty;

    if (speciesGroups.Keys.Contains(Model.SpeciesGroup))
    {
        speciesGroupImageUrl = speciesGroups[Model.SpeciesGroup]["image"];
    }

    var expertCommitteeName = await _expertCommitteeMemberService.GetExpertCommitteeName(Model.ExpertCommittee, Model.AssessmentYear);
    AssessmentPageHeaderViewModel assessmentPageHeaderViewModel = new AssessmentPageHeaderViewModel()
    {
        AssessmentArea = Model.AssessmentArea == "S" ? "Svalbard" : "Norge",
        scientificNameViewModel = new ScientificNameViewModel()
        {
            PopularName = Model.PopularName,
            ScientificName = Model.ScientificName,
            ScientificNameAuthor = Model.ScientificNameAuthor
        },
        speciesGroupViewModel = new SpeciesGroupViewModel()
        {
            AssessmentYear = Model.AssessmentYear,
            ExpertCommittee = Model.ExpertCommittee,
            RevisionDate = Model.RevisionDate,
            RevisionReason = Model.RevisionReason,
            SpeciesGroup = Model.SpeciesGroup,
            SpeciesGroupImageUrl = speciesGroupImageUrl,
            SpeciesGroupInfoUrl = "https://www.artsdatabanken.no/rodlisteforarter2021/ekspertkomiteene",
            PreviousAssessmentYear = Model.YearPreviousAssessment,
        }
    };

    var pageMenuViewModel = new PageMenuViewModel
    {
        PageMenuContentId = Constants.RedlistSpecies2021PageMenuContentId,
        PageMenuExpandButtonText = Constants.RedlistSpecies2021PageManuExpandButtonText,
        PageMenuHeaderText = Constants.RedlistSpecies2021PageMenuHeaderText
    };

    var sideBarContentViewModel = new SideBarContentViewModel()
    {
         AssessmentYear = Model.AssessmentYear,
         Category = @ViewBag.categories[Model.Category.Substring(0, 2)]["presentationstring"],
         CategoryShort = Model.Category,
         PreviousAssessments = Model.PreviousAssessments.Select(x => new SideBarContentViewModel.SideBarPreviousAssessment()
         {
             Category = @ViewBag.categories[x.Category.Substring(0, 2)]["presentationstring"],
             CategoryShort = x.Category,
             Url = x.AssessmentUrl,
             Year = x.Year
         }).ToArray(),
         ScientificName = Model.ScientificName,
         ScientificNameId = Model.ScientificNameId,
         TaxonRank = Model.TaxonRank,
    };

    var categoryDescriptionViewModel = new CategoryDescriptionViewModel()
            {
                CategoryShort = Model.Category,
                CategoryBar = new CategoryBarListElement[]
                {
                     new CategoryBarListElement {
                        Name = "Ikke vurdert",
                        NameShort = "NE"
                    },
                    new CategoryBarListElement {
                        Name = "Ikke egnet",
                        NameShort = "NA"
                    },
                    new CategoryBarListElement {
                        Name = "Livs- kraftig",
                        NameShort = "LC"
                    },
                    new CategoryBarListElement {
                        Name = "Data- mangel",
                        NameShort = "DD"
                    },
                    new CategoryBarListElement {
                        Name = "Nær truet",
                        NameShort = "NT"
                    },
                    new CategoryBarListElement {
                        Name = "Sårbar",
                        NameShort = "VU"
                    },
                    new CategoryBarListElement {
                        Name = "Sterkt truet",
                        NameShort = "EN"
                    },
                    new CategoryBarListElement {
                        Name = "Kritisk truet",
                        NameShort = "CR"
                    },
                    new CategoryBarListElement {
                        Name = "Regionalt utdødd",
                        NameShort = "RE"
                    }
                },
                MethodUrl = "https://www.artsdatabanken.no/rodlisteforarter2021/Metode#316483"
            };

    var naturtypehovedenhet = Model.MainHabitat;
    string geografi = Model.AssessmentArea;

    if (geografi == "N")
    {
        geografi = "Norge";
    }
    else if (geografi == "S")
    {
        geografi = "Svalbard";
        if (@Model.ExpertCommittee == "Pattedyr (Svalbard)")
        {
            geografi = "Svalbard med kyst";
        }
    }
}

<partial name="/Views/Redlist/Species/2021/Assessment/partials/_Breadcrumb.cshtml" />

<div class="pagecontainer">
    <partial name="/Views/Shared/_PageMenu.cshtml" model="pageMenuViewModel" />

    <div class="content-placer bigmid">
        <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Archived.cshtml" />
        <div class="mid-content with_sidebar">
            <partial name="/Views/Shared/_AssessmentPageHeader.cshtml" model="assessmentPageHeaderViewModel" />
            <div class="mobile_padding">
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Ingress.cshtml" />
                <partial name="/Views/Shared/_CategoryDescription.cshtml" model="categoryDescriptionViewModel" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_ExpertStatement.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Method.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_ImpactFactors.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Regions.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Habitat.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_SpeciesDetails.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Reference.cshtml" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Citation.cshtml" model="Model" />
                <partial name="/Views/Redlist/Species/2021/Assessment/partials/_Revision.cshtml" model="Model" />
            </div>
        </div>
        <div class="side mobile_padding">
            <partial name="/Views/Shared/_SidebarContent.cshtml" model="sideBarContentViewModel" />
        </div>
    </div>
</div>
