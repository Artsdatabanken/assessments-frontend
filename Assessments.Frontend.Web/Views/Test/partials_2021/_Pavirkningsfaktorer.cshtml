@model IEnumerable< Artsdatabanken.RL2021Pavirkningsfaktor>

<div class="section">
    <h2>Påvirkningsfaktorer </h2>

    <div class="section">
        <h3>Informasjonsboks - popup (midlertidig faktaboks)</h3>
        @*
        <button class="detaljer" onclick="togglePopup('påvirkningMobile')">
            <img src="/Content/images/help_outline.png" style="height: 18px" alt="Question mark" />
        </button>
        *@

        <!-- Start Popup -->
        <div class="popuptext" id="påvirkningMobile">

            @*<button class="closePopup" onclick="closePopup('påvirkningMobile')"> x </button>*@
            <div>
                Påvirkningsfaktorer er i hovedsak menneskeskapte faktorer som antas å påvirke arten negativt.
                Klassifiseringssystemet for påvirkningsfaktorer er hierarkisk. Valg av påvirkningsfaktor på et overordnet nivå, eks. "Påvirkning på habitat" betyr ikke at alle underliggende nivå nødvendigvis er oppfylt, men at det kan være usikkert hvilke påvirkningsfaktorer på de lavere nivåene som gjør seg gjeldende for arten.
                For hver påvirkningsfaktor er tidsrom, omfang og alvorlighetsgrad angitt. Omfang og alvorlighetsgrad er relativt til den totale populasjonsstørrelsen eller forekomstarealet.
            </div>
        </div><!-- End Popup -->

    </div><!-- End section -->

    <div class="factors">
        @{string currentøverste = "";
            foreach (var pfaktor in Model)
            {

                <div class="pavirknings-boks">
                    @if (pfaktor.ØversteTittel != currentøverste)
                    {
                        currentøverste = pfaktor.ØversteTittel;
                        <h3 class="øverstetittel">@pfaktor.ØversteTittel</h3>
                    }


                    <!-- TODO: Figure out what this is, as it appears to be the same as that above?
                         GOOD SPECIES EXAMPLE: Najas flexilis -->
                    @{
                        string ReplaceLastOccurrence(string Source, string Find, string Replace)
                        {
                            // Example of pre-formatted look: Landbruk > Jordbruk - Drenering (grøfting)
                            // Splits string at keypoints and turns into list. 
                            int place = Source.LastIndexOf(Find);
                            if (place == -1)
                                return Source;
                            string result = Source.Remove(place, Find.Length).Insert(place, Replace);
                            return result;
                        }

                        var tittels = ReplaceLastOccurrence(pfaktor.Tittel, " - ", " > ").Split(">").Select(s => s.Trim()).ToList();
                        for (var n = 0; n < tittels.Count; n++)
                        {
                            <h4 class="subtittel">@tittels[n]</h4>
                        }
                    }


                    @{
                        string omfang = pfaktor.Omfang.Replace("< ", "<&nbsp;").Replace("> ", ">&nbsp;");
                        <h5>Omfang</h5>
                        <p>@Html.Raw(omfang)</p>

                    }
                    @{
                        string alvorlighetsgrad = pfaktor.Alvorlighetsgrad.Replace("< ", "<&nbsp;").Replace("> ", ">&nbsp;");
                        <h5>Alvorlighetsgrad</h5>
                        <p>@Html.Raw(alvorlighetsgrad)</p>
                    }
                    <h5>Tidspunkt</h5>
                    <p>@pfaktor.Tidspunkt</p>

                    <hr/>
                </div>

            }
        }
    </div> <!-- end pavirkningsboks -->
</div> <!-- end factors -->






